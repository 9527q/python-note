# Linux

![tux](images/tux.png)

（Linux 吉祥物 Tux）

Linux（/ˈlɪnəks/）是一种自由和开放源代码的类UNIX操作系统。该操作系统的内核由林纳斯·托瓦兹（Linus Benedict Torvalds）在1991年10月5日（未满22周岁）首次发布。

Linux可以运行在服务器和其他大型平台之上，如大型计算机和超级计算机。世界上500个最快的超级计算机90％以上运行Linux发行版或变种，包括最快的前10名超级计算机运行的都是基于Linux内核的操作系统。Linux也广泛应用在嵌入式系统上，如手机（Mobile Phone）、平板电脑（Tablet）、路由器（Router）、电视（TV）和电子游戏机等。在移动设备上广泛使用的Android操作系统就是创建在Linux内核之上。

通常情况下，Linux被打包成供个人计算机和服务器使用的Linux发行版，一些流行的主流Linux发布版，包括Debian（及其派生版本Ubuntu、Linux Mint）、Fedora（及其相关版本Red Hat Enterprise Linux、CentOS）和openSUSE等。

## 常用命令

命令 | 使用 | 说明
-|-|-
~ | | 当前用户家目录
/ | | 根目录
. | | 当前目录
.. | | 上级目录
cd | cd path | change directory 切换到 path 路径下
 | cd | 不加参数：切换到家目录
 | cd - | 之前的目录
df | df -h | 查看各文件系统空间使用情况
top | | 查看系统实时运行情况
service | service serve_name opt | opt: status/start/stop`,服务状态、开启、关闭
locale | 将语言环境的信息写到标准输出
tail | tail file | 查看文件 file 最后 10 行的内容
| tail -number file | 查看文件 file 最后 number 行
| tail +number file | 查看文件 file 第 number 行（包括）之后的内容
| tail -f file | 查看文件 file 最后10行的实时内容

## 常用文件

文件 | 说明
-|-
/var/log/syslog | 系统日志
/etc/hosts |
/etc/apt/sources.list | 软件源

## 查看端口

1. `lsof -i:端口号`：查看某一端口的占用情况

    ```bash
    $ lsof -i:7001
    COMMAND    PID   USER   FD   TYPE             DEVICE SIZE/OFF NODE NAME
    python2.7 7553 ikeliu    5u  IPv4 0x99bd5b3403b7df55      0t0  TCP *:afs3-callback (LISTEN)
    ```

2. `netstat -tunlp | grep 端口号`：查看指定端口号的进程情况
    - -t (tcp) 仅显示tcp相关选项
    - -u (udp)仅显示udp相关选项
    - -n 拒绝显示别名，能显示数字的全部转化为数字
    - -l 仅列出在Listen(监听)的服务状态
    - -p 显示建立相关链接的程序名

## 修改Ubuntu软件源

1. 修改源文件
    >修改为清华源
    >阿里源则将地址替换为：`http://mirrors.aliyun.com/ubuntu/`
    >注意不同Ubuntu版本是不同的
2. `sudo apt-get update`访问源列表里的每个网址，并读取软件列表，然后保存在本地电脑
3. sudo apt-get upgrade
    把本地已安装的软件，与刚下载的软件列表里对应软件进行对比，如果发现已安装的软件版本太低，就会提示你更新

## 切换到超级用户

ikeliu@ubuntu:~$ su
然后输入超级用户的密码即可
输入正确密码后提示‘认证失败’
Ubuntu安装后，root用户默认是被锁定的，不允许登录，也不允许`su`到root，这时用`sudo passwd`命令修改一下密码就可以su到root用户了，注意必须加sudo，直接passwd修改的是当前用户的密码。

## Ubuntu安装搜狗输入法

官网下载安装包放到Ubuntu
sudo apt install gdebi
右键点击安装包，打开方式选择GDebi Package Installer
再点击安装即可
安装好后修改系统的「语言支持」的「键盘输入法系统」为fcitx，重启即可

## 简介

>最初由芬兰人Linus Torvalds在赫尔辛基大学上学时出于个人爱好而编写。(21岁)  
>
>Linux是一套免费使用、自由传播的类Unix操作系统，是一个基于POSIX和UNIX的多用户、多任务、支持多线程和多CPU的操作系统
>
>Linux能运行主要的UNIX工具软件、应用程序和网络协议。它支持32位和64位硬件。Linux继承了Unix以网络为核心的设计思想，是一个性能稳定的多用户网络操作系统。

## 内核及发行版

kernel是系统的心脏，分为稳定版和开发版

[内核源码](http://www.kernel.org)

> 发行版
>
> 就是将Linux内核与应用软件做一个打包
>
> 较知名的有Ubuntu、RedHat、CentOS、Debian等

## 应用

嵌入式设备、超算、服务器领域（LAMP、LNMP）、个人桌面(弱)

## 多用户操作系统

> Unix和Linux的设计初衷  
> > Winxp之前都是单用户操作系统

## 文件或目录

名称最长265个字符，大小写敏感，没有严格的后缀（格式）

## 主要目录

没有盘符，只有文件，一切皆文件

- / : 根目录，一切的开头
- /bin、/usr/bin : 存放可执行二进制文件，比如ls、tar等
- /boot : 系统启动时用的文件
- /dev : 设备文件
- /etc : 系统配置文件
- /home : 默认的用户家目录，新增用户时，家目录都存放在此目录下
  - `~` 表示当前用户的家目录
  - `~sanr` 表示用户`sanr`的家目录
- /lib、/usr/lib、/usr/local/lib : 系统使用的函数库的目录
- /lost+fount：系统异常产生错误时，会将一些遗失的片段放置于此目录下
- /opt：给主机额外安装软件所摆放的目录
- /proc：此目录的数据都在内存中，如系统核心，外部设备，网络状态，由于数据都存放于内存中，所以不占用磁盘空间，比较重要的文件
- /root：系统管理员root的家目录
- /sbin、/usr/sbin、/usr/local/sbin：放置系统管理员使用的可执行命令，如 fdisk、shutdown、mount 等。与 /bin 不同的是，这几个目录是给系统管理员 root 使用的命令，一般用户只能"查看"而不能设置和使用
- /tmp：一般用户或正在执行的程序临时存放文件的目录，任何人都可以访问，重要数据不可放置在此目录下
- /mnt: /media：光盘默认挂载点，通常光盘挂载于 /mnt/cdrom 下，也不一定，可以选择任意位置进行挂载
- /srv：服务启动之后需要访问的数据目录，如 www 服务需要访问的网页数据存放在 /srv/www 内
- /usr：应用程序存放目录
  - /usr/bin：存放应用程序
  - /usr/share：存放共享数据
  - /usr/lib：存放不能直接运行的，却是许多程序运行所必需的一些函数库文件
  - /usr/local：存放软件升级包
  - /usr/share/doc：系统说明文件存放目录
  - /usr/share/man：程序说明文件存放目录
- /var：放置系统执行过程中经常变化的文件
  - /var/log：随时更改的日志文件
  - /var/spool/mail：邮件存放的目录
  - /var/run：程序或服务启动后，其 PID 存放在该目录下

## 快捷键

快捷键 | 作用 | 补充
-|-|-
Tab | 终端自动补齐 | 或提示可能的命令文件等
Ctrl L | 终端清屏
Ctrl - | 缩小终端字体
Ctrl Shift = | 放大终端字体
Ctrl Shift C | 终端中复制 | Ctrl Insert
Ctrl Shift V | 终端中粘贴 | Shift Insert
Ctrl Shift T | 当前终端界面再分出一个终端
Ctrl Alt T | 打开新终端

## 运行文件

如果就在当前目录下：`./可执行文件`  
(不能只写`可执行文件`)

> python文件的开头添加
> ```py
> #!/usr/bin/python
> ```
> 再添加可执行权限即可直接运行

## 修改软件源

1. 打开Ubuntu任务栏的"系统设置"
2. 打开软件和更新
3. 选择"Ubuntu软件"中的下载自"其他站点..."
4. 选择"中国"，选择合适的服务器，协议默认
5. 点击选择服务器
6. 弹出认证窗口，输入用户密码，进行授权
7. 授权完成后，点击关闭
8. 最后提示，直接点击关闭即可

## 自动补全

- 在敲出 文件、目录、命令的前几个字母之后，按下 tab 键
  - 如果输入的没有歧义，系统会自动补全
  - 如果还存在其他文件、目录、命令，再按一下 tab 键，系统会提示可能存在的命令
- 上下键可以在曾经使用过的命令之间来回切换
- 如果想要退出选择，并且不想执行当前选中的命令，可以按 ctrl + c

## 通配符

通配符 | 含义
-|-
`*` | 文件代表文件名中所有字符
`ls te*` | 查找以te开头的文件
`ls *html` | 查找结尾为html的文件
`？` | 代表文件名中任意一个字符
`ls ?.c` | 只找第一个字符任意，后缀为.c的文件
`ls a.?` | 只找只有3个字符，前2字符为a.，最后一个字符任意的文件
`[]` | [”和“]”将字符组括起来，表示可以匹配字符组中的任意一个。“-”用于表示字符范围。
`[abc]` | 匹配a、b、c中的任意一个
`[a-f]` | 匹配从a到f范围内的的任意一个字符
`ls [a-f]*` | 找到从a到f范围内的的任意一个字符开头的文件
`ls a-f` | 查找文件名为a-f的文件,当“-”处于方括号之外失去通配符的作用
`\` | 如果要使通配符作为普通字符使用，可以在其前面加上转义字符。“?”和“*”处于方括号内时不用使用转义字符就失去通配符的作用。
`ls \*a` | 查找文件名为*a的文件

## help、man、`clear`

### `--help`

```sh
command --help
```

### man

```sh
man command
```

- manual缩写
- 操作键
  - 空格 下一页
  - Enter 向下滚动一行
  - B 上一页
  - F 下一页
  - Q 退出
  - `/word` 搜索word字符串（会高亮显示）
  - H 帮助
- 到最后一页也不会自动退出

## `ls`、`ll`

list缩写

可接目录参数，`.`表示当前目录，`..`表示上一级

选项 | 含义
-|-
`-a` | 显示所有，包括隐藏文件
`-l` | 以列表方式显示文件的详细信息
`-h` | 配合 -l 以人性化的方式显示文件大小(单独使用没用)
> 多个命令可以单独写`-x -x`也可以一起写`-xx`

`ll` = `ls -al`

查看详细信息时

- 第一行会打印该目录总大小
- 第一位表示文件类型
  - `d` 目录
  - `-` 文件
- rwx表示存取执行权限
- 数字表示硬链接数
- 两个名称表示文件属主和属组

## `cd`、`pwd`、`tree`

### `cd`

- 不加参数切换到当前用户主目录，也是用户登录时的默认目录
- `cd ~`同上
- `cd -`上次所在的目录

## mkdir、touch、rm

### mkdir

- 新建目录
- `-p`选项可递归创建目录
- 不能与已有目录或文件重名，必须具有写权限

### touch

创建文件

### rm

删除后不能恢复

选项 | 含义
-|-
-i | 以进行交互式方式执行
-f | 强制删除，忽略不存在的文件，无需提示
-r | 递归地删除目录下的内容，删除目录时必须加此参数

## cp、mv

### cp

选项 | 含义
-|-
-i | 交互式复制，在覆盖目标文件之前将给出提示要求用户确认
-r | 若给出的源文件是目录文件，则cp将递归复制该目录下的所有子目录和文件，目标文件必须为一个目录名。
-v | 显示拷贝进度

### mv

用来移动或重命名，目录内也一起复制

选项 | 含义
-|-
-f | 禁止交互式操作，如有覆盖也不会给出提示
-i | 确认交互方式操作，如果mv操作将导致对已存在的目标文件的覆盖，系统会询问是否重写，要求用户回答以避免误覆盖文件
-v | 显示移动进度

## > >> |

`>` `>>`将命令执行结果重定向到一个文件，本应显示在终端上的内容保存到指定文件中。

`>`输出重定向会覆盖原来的内容  
`>>`输出重定向则会追加到文件的尾部

## vim、vi、gedit、more、cat

### gedit

纯文本编辑器，可高亮显示

### more

分屏查看文件内容，到最后会自动退出

快捷键 | 作用
-|-
空格键 | 显示下一页
Q | 退出
H | 获取帮助
B | 上一页
/正则表达式 | 查找

### cat

可接多个文件参数，连续输出，配合重定向可以完成合并文件内容的功能

## ln

- `-s`为软链接
- 硬链接只能链接文件，不能链接目录

## grep、find

### grep

查找文本中的内容

```sh
grep [-选项] '搜索内容串' 文件名
```

选项 | 含义
-|-
-v | 显示不包含匹配文本的所有行（相当于求反）
-n | 显示匹配行及行号
-i | 忽略大小写

搜索内容可以是正则表达式

### find

通常用来在特定的目录下搜索符合条件的文件。

命令 | 含义
-|-
`find ./ -name test.sh` | 查找当前目录下所有名为test.sh的文件
`find ./ -name '*.sh'` | 查找当前目录下所有后缀为.sh的文件
`find ./ -name "[A-Z]*"` | 查找当前目录下所有以大写字母开头的文件
`find /tmp -size 2M` | 查找在/tmp 目录下等于2M的文件
`find /tmp -size +2M` | 查找在/tmp 目录下大于2M的文件
`find /tmp -size -2M` | 查找在/tmp 目录下小于2M的文件
`find ./ -size +4k -size -5M` | 查找当前目录下大于4k，小于5M的文件
`find ./ -perm 777` | 查找当前目录下权限为 777 的文件或目录

## tar、gzip、bzip2、zip、unzip

### tar

计算机中的数据经常需要备份，tar是Unix/Linux中最常用的备份工具，此命令可以把一系列文件归档到一个大文件中，也可以把档案文件解开以恢复数据。

```sh
tar [选项] 打包文件名 文件
```

tar命令很特殊，其选项前面可以使用“-”，也可以不使用。

选项 | 含义
-|-
-c | 生成档案文件，创建打包文件
-v | 列出归档解档的详细过程，显示进度
-f | 指定档案文件名称，f后面一定是.tar文件，所以必须放选项最后
-x | 解开档案文件
-C | 解包到指定目录
-z | 调用gzip实现打包并压缩或解压并解包（原文件还在）
-j | 调用bzip2

- eg: `tar -cvf test.tar *`
  - 文件可以是一个也可以是多个，通配符也行
- 打包后源文件还在，解包后包文件还在
- 解包到当前文件夹无需写目标目录
- 如果解包到其他目录需要在目录前加`-C`选项

### gzip

tar与gzip命令结合使用实现文件打包、压缩。 tar只负责打包文件，但不压缩，用gzip压缩tar打包后的文件，其扩展名一般用xxxx.tar.gz。

```sh
gzip  [选项]  被压缩(解压)文件
```

- 压缩无需参数
- `-d`表示解压
- 压缩或解压后原文件不存在
- 压缩或解压自动添加或去掉后缀.gz

### bzip2

与gzip相同，后缀为gz2

### zip、unzip

通过zip压缩文件的目标文件不需要指定扩展名，默认扩展名为zip。

## chmod、sudo

### chmod

字母法与数字法

```sh
chmod u/g/o/a+/-/=rwx 文件
chmod u+/-/=rwx,g... 文件
chmod 754 文件
```

- `-R`参数递归修改目录下所有文件权限

### `sudo -s`

切换到root用户

- `~$`标识为普通用户
- `~#`标识为root用户

## whoami、who、exit、passwd、reboot、shutdown

### whoami、who

whoami显示当前用户名  
who显示当前所有登录系统的用户名、登录方式、登录时间、ip

登录方式  
tty7表示本地登录  
pts表示远程登录

- `who -q` 只显示所有登录账号名和总数量
- `who -b`查看上一次重启时间和日期

### exit

exit返回上一个登录账号，没有则退出

### reboot

立即重启没有提示

### shutdown

命令 | 含义
-|-
`shutdown` | 一分钟后关机
`shutdown –r now` | 关机后立即重新启动操作系统
`shutdown -h now` | 立刻关机，其中now相当于时间为0的状态
`shutdown -h 20:25` | 系统在今天的20:25 会关机
`shutdown -h +10` | 系统再过十分钟后自动关机
`shutdown -c` | 取消关机计划

## ps、kill

### ps

显示这一瞬间进程的状态

- `ps ax`或`ps aux` To see every process on the system using BSD syntax
  - u表示以用户为主的格式来显示

常配合grep来查看进程（这一grep也是一个进程）

- `ps -ef` To see every process on the system using standard syntax

### kill

强制杀死

```sh
kill -9 进程
```

## ping、ifconfig

```sh
ping 网址/IP地址  # 检测网络，ping网址下面也会显示出ip
ifconfig  # 查看网卡信息，最前面的是网卡名
```

## lsof、netstat

### lsof

lsof(list open files)是一个列出当前系统打开文件的工具。在linux环境下，任何事物都以文件的形式存在，通过文件不仅仅可以访问常规数据，还可以访问网络连接和硬件。

因为 lsof 需要访问核心内存和各种文件，所以必须以 root 用户的身份运行它才能够充分地发挥其功能。

每行显示一个打开的文件

命令 | 意义 | 补充
-|-|-
`lsof` | 不加任何参数，显示所有被打开的文件
`lsof /filepath/file` | 查看打开某个文件的进程
`lsof -u username` | 查看某个用户打开的文件信息
`lsof -c mysql` | 查看某个程序打开的文件信息 | 所有以mysql开头的程序都列出来,多个程序用多个-c分别连接名字即可
`lsof -u test -c mysql` | 列出某个用户以及某个程序所打开的文件信息
`lsof   -u ^root` | 列出除了某个用户外的被打开的文件信息
`lsof -p 1` | 通过某个进程号显示该进行打开的文件
`lsof -p 123,456,789` | 列出多个进程号对应的文件信息
`lsof -p ^1` | 列出除了某个进程号，其他进程号所打开的文件信息
`lsof -i` | 列出所有的网络连接
`lsof  -i tcp/udp` | 列出所有tcp/udp网络连接信息
`lsof -i :3306` | 列出谁在使用某个端口
`lsof -i udp/tcp:55` | 列出谁在使用某个特定的udp/tcp端口
`lsof -g 5555` | 某个用户组所打开的文件信息

### netstat

选项  | 意义
-|-
`-a` | 显示所有socket，包括正在监听的。  
`-n` | 以网络IP地址代替名称，显示出网络连接情形。
`-t` | 显示TCP协议的连接情况
`-u` | 显示UDP协议的连接情况。
`-p` |  显示建立相关连接的程序名和PID

## 软件相关操作

apt命令 | apt-get命令 | 命令的功能
-|-|-
`apt install` | `apt-get install` | 安装软件包
`apt remove` | `apt-get remove` | 移除软件包
`apt purge` | `apt-get purge` | 移除软件包及配置文件
`apt update` | `apt-get update` | 刷新存储库索引
`apt upgrade` | `apt-get upgrade` | 升级所有可升级的软件包
`apt autoremove` | `apt-get autoremove` | 自动删除不需要的包
`apt full-upgrade` | `apt-get dist-upgrade` | 在升级软件包时自动处理依赖关系
`apt search` | `apt-cache search` | 搜索应用程序
`apt show` | `apt-cache show` | 显示安装细节

apt还有一些自己的命令：
新的apt命令 | 命令的功能
-|-
`apt list` | 列出包含条件的包（已安装，可升级等）
`apt edit-sources` | 编辑源列表

## vim

vi编辑器是Linux和Unix上最基本的文本编辑器，工作在字符模式下。在系统和服务器管理中的功能是那些图形编辑器所无法比拟的。有众多文本操作，而且用户可以根据自己的需要对其进行定制。不是排版程序，不能对字体、格式等属性设置，只能编辑文本。没有菜单只有命令。

vim是vi的加强版。

## 三种模式

命令模式、编辑模式、末行模式

模式切换：

- Esc进入命令模式（刚打开时的模式）
- `i`、`a`、`I`、`A`、`o`、`O`从命令模式进入编辑模式
  - i光标前，a光标后
  - I行首，A行末
  - o在下面插入一行，O在上面插入一行
- `Shift ;`(即`:`)从命令模式进入末行模式

末行模式：

命令 | 作用
-|-
`w` | 保存
`q` | 退出
`wq` | 保存退出
`q!` | 不保存 强制退出
查找命令 | /
`/ + str` | n查找下一个，N查找前一个
`%s/abc/123/g` | 将文件中所有abc替换为123
`1,10s/abc/123/g` | 将第一行至第10行之间的abc替换成123

命令模式：

命令 | 作用
-|-
插入命令 | /
`iaIAoO` | 进入编辑模式
光标移动命令 | /
`hjkl` | 左下上右移动光标
`^`、`$` | 光标移动到行首、行末
`H`、`M`、`L` | 光标移动到屏幕中第一行、中间行、最后一行
`gg`、`G` | 光标移动到文档第一行、最后一行
`Ctrl f`、`ctrl b` | 向前一屏、向后一屏
`Ctrl d`、`Ctrl u` | 向前半屏、向后半屏（down、up）
`{`、`}` | 向上一段、向下一段
`wb` | 向前一个单词、向后一个单词
删除命令 | /
`X`、`x` | x删除光标后一个字符，X删除光标前一个字符,包含光标位置字符
`dd`、`n dd` | dd删除所在行，5 dd删除指定行数
`d0`和`D` | d0删除光标前本行所有内容，D删除光标后本行所有内容，包含光标位置字符
`dw` | 删除光标所在位置的字，包含光表所在位置字符
撤销命令 | /
`u` | 一步一步撤销
`ctrl r` | 反撤销
重复命令 | /
`.` | 重复执行上一次操作的命令
复制粘贴命令 | /
`yy、n yy、y$` | yy复制当前行，5 yy复制5行，`y$`只赋值本行文本，不复制行尾换行符
`p` | 如果是yy复制的，则新开一行粘贴内容，如果是`y$`复制的，则在光标处粘贴文本内容
选择文本 | /
`v`和`V` | v选择单个字符，V选择整行
`<<`和`>>` | 选择文本之后，向左缩进，向右缩进（Shift+ 命令）
查找替换 | /
`r`和`R` | r替换当前字符，R替换光标后的字符